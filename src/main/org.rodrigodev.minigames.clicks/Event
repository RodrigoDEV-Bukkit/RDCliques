package org.rodrigodev.minigames.clicks;

import java.util.ArrayList;

import org.bukkit.Bukkit;
import org.bukkit.Sound;
import org.bukkit.entity.Player;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.block.Action;
import org.bukkit.event.player.PlayerInteractEvent;
import org.rodrigodev.minigames.clicks.Storage.Archive;

public class Event implements Listener{
	
	
	 public static ArrayList<String> Cliks = new ArrayList<String>();

	  public static void Principal(Player p)
	  {
	    p.setLevel(0);

	    START(p);
	    RESULT(p);
	    STOP(p);
	  }
	  
	  
	  @EventHandler
	  public void LAST(PlayerInteractEvent e) {
	    Player p = e.getPlayer();
	    if ((Cliks.contains(p.getName())) && 
	      (e.getAction() == Action.LEFT_CLICK_AIR)){
	      p.setLevel(p.getLevel() + 1);
	      
	      if(Archive.instance.Configuraçao.getBoolean("Habilitar_Som")){
	    	  p.playSound(p.getLocation(), Sound.valueOf(Archive.instance.Configuraçao.getString("Som")), 4F, 2F);
	      }
	      
	    }
	  }
	  
	  @EventHandler
	  public void Safado(PlayerInteractEvent e) {
	    Player p = e.getPlayer();
	    if ((Cliks.contains(p.getName())) && 
	      (e.getAction() == Action.RIGHT_CLICK_BLOCK)){
	    	
	    	p.sendMessage("§a[CM] §cSomente os cliques no ar são contabilizados, ou espere o tempo acabar para continuar seus afazeres !");
	      
	    }
	  }
	  
	  
	  public static void RESULT(Player p) {
		  
		    Bukkit.getScheduler().scheduleSyncDelayedTask(Click.get(), new Runnable() {
		    	
		    	
		      public void run() {
		    	  
		    	  
	    				for (String Mensagem : Archive.instance.Configuraçao.getStringList("Msg_Resultado")){
	    					p.sendMessage(Mensagem.replaceAll("&", "§")
	    							.replace("{nome}", p.getName())
	    							.replace("{cliques}", Integer.toString(p.getLevel()))
	    							.replace("{porcentagem}", Integer.toString(p.getLevel() / 10)));
		    	  }
		         }
		       }
		    , 300L);
		  }
	  
	  public static void STOP(Player p) {
		    Bukkit.getScheduler().scheduleSyncDelayedTask(Click.get(), new Runnable()
		    {
		      public void run()
		      {
		        Bukkit.getScheduler().cancelAllTasks();

		        Cliks.remove(p.getName());
		        p.setLevel(0);

		      }
		    }
		    , 301L);
		  }
	  
	  public static void START(Player p) {
	      
		     p.sendMessage(Archive.instance.Configuraçao.getString("Msg_Começando.1").replace("&", "§"));
		     
		      Bukkit.getServer().getScheduler().scheduleSyncDelayedTask(Click.get(), new Runnable()
		      {
		        public void run()
		        {

		        	 p.sendMessage(Archive.instance.Configuraçao.getString("Msg_Começando.2").replace("&", "§"));
		          
		        }
		      }
		      , 20L);

		      Bukkit.getServer().getScheduler().scheduleSyncDelayedTask(Click.get(), new Runnable()
		      {
		        public void run()
		        {
		        	
		        	 p.sendMessage(Archive.instance.Configuraçao.getString("Msg_Começando.3").replace("&", "§"));
		        }
		      }
		      , 40L);

		      Bukkit.getServer().getScheduler().scheduleSyncDelayedTask(Click.get(), new Runnable()
		      {
		        public void run()
		        {
		        	 p.sendMessage(Archive.instance.Configuraçao.getString("Msg_Começando.4").replace("&", "§"));
		        }
		      }
		      , 60L);

		      Bukkit.getServer().getScheduler().scheduleSyncDelayedTask(Click.get(), new Runnable()
		      {
		        public void run()
		        {
		        	 p.sendMessage(Archive.instance.Configuraçao.getString("Msg_Começando.5").replace("&", "§"));
		        }
		      }
		      , 80L);

		      Bukkit.getServer().getScheduler().scheduleSyncDelayedTask(Click.get(), new Runnable()
		      {
		        public void run()
		        {
		        	
		        	 p.sendMessage(Archive.instance.Configuraçao.getString("Msg_Começando.Iniciou").replace("&", "§"));
		        	 Cliks.add(p.getName());
		        	 RESULT(p);
		        }
		      }
		      , 100L);
		  }

}
